<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Introduction to Spatial Analysis in R</title>
  <meta name="description" content="Introduction to Spatial Analysis in R">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Introduction to Spatial Analysis in R" />
  <meta property="og:type" content="book" />
  
  
  
  <meta name="github-repo" content="Doi90/EE_Intro_Spatial_Workshop" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Introduction to Spatial Analysis in R" />
  
  
  

<meta name="author" content="Roozbeh Valavi, Jutta Beher, and David Wilkinson">


<meta name="date" content="2019-07-29">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="vector-data.html">
<link rel="next" href="combining-vector-and-raster-data.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Intro to spatial analysis in R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Home page</a></li>
<li class="chapter" data-level="2" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>2</b> Introduction</a></li>
<li class="chapter" data-level="3" data-path="vector-data.html"><a href="vector-data.html"><i class="fa fa-check"></i><b>3</b> Vector Data</a><ul>
<li class="chapter" data-level="3.1" data-path="vector-data.html"><a href="vector-data.html#vector-data-and-features"><i class="fa fa-check"></i><b>3.1</b> Vector data and features</a></li>
<li class="chapter" data-level="3.2" data-path="vector-data.html"><a href="vector-data.html#simple-features-in-r"><i class="fa fa-check"></i><b>3.2</b> Simple features in <code>R</code></a></li>
<li class="chapter" data-level="3.3" data-path="vector-data.html"><a href="vector-data.html#sf-package"><i class="fa fa-check"></i><b>3.3</b> sf package</a><ul>
<li class="chapter" data-level="3.3.1" data-path="vector-data.html"><a href="vector-data.html#reading-and-converting-data-to-sf"><i class="fa fa-check"></i><b>3.3.1</b> Reading and converting data to <code>sf</code></a></li>
<li class="chapter" data-level="3.3.2" data-path="vector-data.html"><a href="vector-data.html#import-data-from-packages"><i class="fa fa-check"></i><b>3.3.2</b> Import data from packages</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="vector-data.html"><a href="vector-data.html#transform-coordinate-reference-system"><i class="fa fa-check"></i><b>3.4</b> Transform coordinate reference system</a></li>
<li class="chapter" data-level="3.5" data-path="vector-data.html"><a href="vector-data.html#challenge-one"><i class="fa fa-check"></i><b>3.5</b> Challenge one</a></li>
<li class="chapter" data-level="3.6" data-path="vector-data.html"><a href="vector-data.html#geometric-operations"><i class="fa fa-check"></i><b>3.6</b> Geometric operations</a><ul>
<li class="chapter" data-level="3.6.1" data-path="vector-data.html"><a href="vector-data.html#cropping-sf"><i class="fa fa-check"></i><b>3.6.1</b> Cropping sf</a></li>
<li class="chapter" data-level="3.6.2" data-path="vector-data.html"><a href="vector-data.html#buffer-and-join"><i class="fa fa-check"></i><b>3.6.2</b> Buffer and join</a></li>
<li class="chapter" data-level="3.6.3" data-path="vector-data.html"><a href="vector-data.html#spatial-join-and-intersection"><i class="fa fa-check"></i><b>3.6.3</b> Spatial join and intersection</a></li>
<li class="chapter" data-level="3.6.4" data-path="vector-data.html"><a href="vector-data.html#nearest-distance"><i class="fa fa-check"></i><b>3.6.4</b> Nearest distance</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="vector-data.html"><a href="vector-data.html#write-spatial-data"><i class="fa fa-check"></i><b>3.7</b> Write spatial data</a></li>
<li class="chapter" data-level="3.8" data-path="vector-data.html"><a href="vector-data.html#challenge-two"><i class="fa fa-check"></i><b>3.8</b> Challenge two</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="raster-data.html"><a href="raster-data.html"><i class="fa fa-check"></i><b>4</b> Raster Data</a><ul>
<li class="chapter" data-level="4.1" data-path="raster-data.html"><a href="raster-data.html#rasters-and-raster-analysis"><i class="fa fa-check"></i><b>4.1</b> Rasters and raster analysis</a></li>
<li class="chapter" data-level="4.2" data-path="raster-data.html"><a href="raster-data.html#understanding-what-a-raster-is"><i class="fa fa-check"></i><b>4.2</b> Understanding what a raster is</a></li>
<li class="chapter" data-level="4.3" data-path="raster-data.html"><a href="raster-data.html#you-can-do-any-maths-with-a-raster"><i class="fa fa-check"></i><b>4.3</b> You can do any maths with a raster!</a><ul>
<li class="chapter" data-level="4.3.1" data-path="raster-data.html"><a href="raster-data.html#optional-task"><i class="fa fa-check"></i><b>4.3.1</b> Optional task:</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="raster-data.html"><a href="raster-data.html#investigate-rasters"><i class="fa fa-check"></i><b>4.4</b> Investigate rasters</a></li>
<li class="chapter" data-level="4.5" data-path="raster-data.html"><a href="raster-data.html#reading-a-raster-into-r"><i class="fa fa-check"></i><b>4.5</b> Reading a raster into R</a></li>
<li class="chapter" data-level="4.6" data-path="raster-data.html"><a href="raster-data.html#reading-a-list-of-rasters-into-r"><i class="fa fa-check"></i><b>4.6</b> Reading a list of rasters into R</a></li>
<li class="chapter" data-level="4.7" data-path="raster-data.html"><a href="raster-data.html#challenge-one-operations-on-raster-stacks"><i class="fa fa-check"></i><b>4.7</b> Challenge One: Operations on raster stacks</a></li>
<li class="chapter" data-level="4.8" data-path="raster-data.html"><a href="raster-data.html#writing-new-rasters-to-file"><i class="fa fa-check"></i><b>4.8</b> Writing new rasters to file</a></li>
<li class="chapter" data-level="4.9" data-path="raster-data.html"><a href="raster-data.html#challenge-2-creating-categories-from-summarizing-and-combining-data"><i class="fa fa-check"></i><b>4.9</b> Challenge 2: Creating categories from summarizing and combining data</a></li>
<li class="chapter" data-level="4.10" data-path="raster-data.html"><a href="raster-data.html#preparation-for-the-reclassification-into-categories"><i class="fa fa-check"></i><b>4.10</b> Preparation for the reclassification into categories:</a></li>
<li class="chapter" data-level="4.11" data-path="raster-data.html"><a href="raster-data.html#reclassification"><i class="fa fa-check"></i><b>4.11</b> Reclassification</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="combining-vector-and-raster-data.html"><a href="combining-vector-and-raster-data.html"><i class="fa fa-check"></i><b>5</b> Combining Vector and Raster Data</a><ul>
<li class="chapter" data-level="5.1" data-path="combining-vector-and-raster-data.html"><a href="combining-vector-and-raster-data.html#challenge-1-which-climate-do-koalas-like"><i class="fa fa-check"></i><b>5.1</b> Challenge 1: Which climate do koalas like?</a></li>
<li class="chapter" data-level="5.2" data-path="combining-vector-and-raster-data.html"><a href="combining-vector-and-raster-data.html#challenge-2-extract-rasters-to-polygons-how-to-summarize-more-complex-extractions."><i class="fa fa-check"></i><b>5.2</b> Challenge 2: Extract rasters to polygons: how to summarize more complex extractions.</a></li>
<li class="chapter" data-level="5.3" data-path="combining-vector-and-raster-data.html"><a href="combining-vector-and-raster-data.html#attach-the-new-information-to-your-shapefile"><i class="fa fa-check"></i><b>5.3</b> Attach the new information to your shapefile</a></li>
<li class="chapter" data-level="5.4" data-path="combining-vector-and-raster-data.html"><a href="combining-vector-and-raster-data.html#count-points-in-polygons"><i class="fa fa-check"></i><b>5.4</b> Count points in polygons</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="plotting-in-base-r.html"><a href="plotting-in-base-r.html"><i class="fa fa-check"></i><b>6</b> Plotting in Base <code>R</code></a><ul>
<li class="chapter" data-level="6.1" data-path="plotting-in-base-r.html"><a href="plotting-in-base-r.html#challenge-1-make-a-simple-map"><i class="fa fa-check"></i><b>6.1</b> Challenge 1: Make a simple map</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="plotting-in-ggplot2.html"><a href="plotting-in-ggplot2.html"><i class="fa fa-check"></i><b>7</b> Plotting in <code>ggplot2</code></a><ul>
<li class="chapter" data-level="7.1" data-path="plotting-in-ggplot2.html"><a href="plotting-in-ggplot2.html#creating-high-quality-graphics"><i class="fa fa-check"></i><b>7.1</b> Creating high quality graphics</a></li>
<li class="chapter" data-level="7.2" data-path="plotting-in-ggplot2.html"><a href="plotting-in-ggplot2.html#grammar-of-graphics"><i class="fa fa-check"></i><b>7.2</b> Grammar of Graphics</a></li>
<li class="chapter" data-level="7.3" data-path="plotting-in-ggplot2.html"><a href="plotting-in-ggplot2.html#plotting-spatial-data-in-ggplot"><i class="fa fa-check"></i><b>7.3</b> Plotting spatial data in ggplot</a><ul>
<li class="chapter" data-level="7.3.1" data-path="plotting-in-ggplot2.html"><a href="plotting-in-ggplot2.html#plotting-vector-data"><i class="fa fa-check"></i><b>7.3.1</b> Plotting vector data</a></li>
<li class="chapter" data-level="7.3.2" data-path="plotting-in-ggplot2.html"><a href="plotting-in-ggplot2.html#different-spatial-reference-in-plotting"><i class="fa fa-check"></i><b>7.3.2</b> Different spatial reference in plotting</a></li>
<li class="chapter" data-level="7.3.3" data-path="plotting-in-ggplot2.html"><a href="plotting-in-ggplot2.html#plotting-raster-data"><i class="fa fa-check"></i><b>7.3.3</b> Plotting raster data</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Introduction to Spatial Analysis in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="raster-data" class="section level1">
<h1><span class="header-section-number">4</span> Raster Data</h1>
<div id="rasters-and-raster-analysis" class="section level2">
<h2><span class="header-section-number">4.1</span> Rasters and raster analysis</h2>
<p>In this section you learn what a raster is, and how to read, plot, and manipulate such data.</p>
<p>First install the required packages</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" title="1"><span class="kw">library</span>(rgdal)</a>
<a class="sourceLine" id="cb35-2" title="2"><span class="kw">library</span>(raster)</a>
<a class="sourceLine" id="cb35-3" title="3"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb35-4" title="4"><span class="kw">library</span>(sf)</a>
<a class="sourceLine" id="cb35-5" title="5"><span class="kw">library</span>(maps)  <span class="co"># for making a scale bar</span></a>
<a class="sourceLine" id="cb35-6" title="6"><span class="kw">library</span>(rgeos) <span class="co"># for labels on polygons</span></a></code></pre></div>
<p>Now set the working directory to your own computer (or better yet be using an R project!).</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" title="1"><span class="kw">setwd</span>(<span class="st">&quot;/Users/juttabeher/Documents/phd_melbourne/workshops/EE_Intro_Spatial_Workshop&quot;</span>)</a></code></pre></div>
</div>
<div id="understanding-what-a-raster-is" class="section level2">
<h2><span class="header-section-number">4.2</span> Understanding what a raster is</h2>
<p>What is a raster? Nothing more than a matrix! The command <code>raster()</code> turns any matrix into a raster-object that can be used for spatial analysis. You will now create your own raster:</p>
<p>Create an empty matrix with the required dimensions:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" title="1">r &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">0</span>, </a>
<a class="sourceLine" id="cb37-2" title="2">            <span class="dt">nrow =</span> <span class="dv">3</span>, </a>
<a class="sourceLine" id="cb37-3" title="3">            <span class="dt">ncol =</span> <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb37-4" title="4"></a>
<a class="sourceLine" id="cb37-5" title="5">r</a></code></pre></div>
<pre><code>##      [,1] [,2] [,3]
## [1,]    0    0    0
## [2,]    0    0    0
## [3,]    0    0    0</code></pre>
<p>Populate each row of the matrix with information (the values of the cells) and use the <code>raster()</code> command to turn it into a raster object, which you can plot.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" title="1">r[ , <span class="dv">1</span>] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)  </a>
<a class="sourceLine" id="cb39-2" title="2">r[ , <span class="dv">2</span>] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>)</a>
<a class="sourceLine" id="cb39-3" title="3">r[ , <span class="dv">3</span>] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">8</span><span class="op">:</span><span class="dv">10</span>)</a>
<a class="sourceLine" id="cb39-4" title="4"></a>
<a class="sourceLine" id="cb39-5" title="5">rr &lt;-<span class="st"> </span><span class="kw">raster</span>(r)</a>
<a class="sourceLine" id="cb39-6" title="6"></a>
<a class="sourceLine" id="cb39-7" title="7">r</a></code></pre></div>
<pre><code>##      [,1] [,2] [,3]
## [1,]    1    5    8
## [2,]    2    6    9
## [3,]    3    7   10</code></pre>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" title="1"><span class="kw">plot</span>(rr)</a></code></pre></div>
<p><img src="EE_Intro_Spatial_Workshop_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
<p>As you can see, every cell has a color according to its value. You will find out later how to select specific colors.</p>
</div>
<div id="you-can-do-any-maths-with-a-raster" class="section level2">
<h2><span class="header-section-number">4.3</span> You can do any maths with a raster!</h2>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb42-1" title="1"><span class="kw">plot</span>(rr <span class="op">*</span><span class="st"> </span><span class="dv">2</span>)</a></code></pre></div>
<p><img src="EE_Intro_Spatial_Workshop_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb43-1" title="1"><span class="kw">plot</span>(rr <span class="op">*</span><span class="st"> </span><span class="dv">100</span>)</a></code></pre></div>
<p><img src="EE_Intro_Spatial_Workshop_files/figure-html/unnamed-chunk-25-2.png" width="672" /></p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb44-1" title="1"><span class="kw">plot</span>(rr <span class="op">+</span><span class="st"> </span>rr)</a></code></pre></div>
<p><img src="EE_Intro_Spatial_Workshop_files/figure-html/unnamed-chunk-25-3.png" width="672" /></p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb45-1" title="1"><span class="kw">plot</span>(rr <span class="op">-</span><span class="st"> </span>rr)</a></code></pre></div>
<p><img src="EE_Intro_Spatial_Workshop_files/figure-html/unnamed-chunk-25-4.png" width="672" /></p>
<div id="optional-task" class="section level3">
<h3><span class="header-section-number">4.3.1</span> Optional task:</h3>
<p>Create a second raster with different numbers, add both rasters up and plot the result.
Did the colors change?</p>
</div>
</div>
<div id="investigate-rasters" class="section level2">
<h2><span class="header-section-number">4.4</span> Investigate rasters</h2>
<p>You can also use these commands to investigate different aspects of the data:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb46-1" title="1"><span class="kw">res</span>(rr) <span class="co"># returns the cell size dimensions (an x and y value)</span></a></code></pre></div>
<pre><code>## [1] 0.3333333 0.3333333</code></pre>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb48-1" title="1"><span class="kw">ncol</span>(rr) <span class="co"># the number of columns</span></a></code></pre></div>
<pre><code>## [1] 3</code></pre>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb50-1" title="1"><span class="kw">nrow</span>(rr) <span class="co"># the number of rows</span></a></code></pre></div>
<pre><code>## [1] 3</code></pre>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb52-1" title="1"><span class="kw">ncell</span>(rr) <span class="co"># the number of cells (rows * columns)</span></a></code></pre></div>
<pre><code>## [1] 9</code></pre>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb54-1" title="1"><span class="kw">dim</span>(rr) <span class="co"># the dimensions of the raster (number of columns, number of rows, number of bands)</span></a></code></pre></div>
<pre><code>## [1] 3 3 1</code></pre>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb56-1" title="1"><span class="kw">crs</span>(rr) <span class="co"># the projection of the raster, if it has one</span></a></code></pre></div>
<pre><code>## CRS arguments: NA</code></pre>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb58-1" title="1"><span class="kw">xmin</span>(rr) <span class="co"># the x and y minimum and maximum coordinates, if there are any</span></a></code></pre></div>
<pre><code>## [1] 0</code></pre>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb60-1" title="1"><span class="kw">ymin</span>(rr) </a></code></pre></div>
<pre><code>## [1] 0</code></pre>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb62-1" title="1"><span class="kw">xmax</span>(rr) </a></code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb64-1" title="1"><span class="kw">ymax</span>(rr)</a></code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb66-1" title="1"><span class="kw">range</span>(<span class="kw">values</span>(rr),   <span class="co"># the range of raster values, ignoring NoData</span></a>
<a class="sourceLine" id="cb66-2" title="2">      <span class="dt">na.rm =</span> <span class="ot">TRUE</span>) </a></code></pre></div>
<pre><code>## [1]  1 10</code></pre>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb68-1" title="1"><span class="kw">cellStats</span>(rr,    <span class="co"># the mean, min, max, sd, sum</span></a>
<a class="sourceLine" id="cb68-2" title="2">          mean) </a></code></pre></div>
<pre><code>## [1] 5.666667</code></pre>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb70-1" title="1"><span class="kw">freq</span>(rr) <span class="co"># for categorical rasters, the frequency of values</span></a></code></pre></div>
<pre><code>##       value count
##  [1,]     1     1
##  [2,]     2     1
##  [3,]     3     1
##  [4,]     5     1
##  [5,]     6     1
##  [6,]     7     1
##  [7,]     8     1
##  [8,]     9     1
##  [9,]    10     1</code></pre>
</div>
<div id="reading-a-raster-into-r" class="section level2">
<h2><span class="header-section-number">4.5</span> Reading a raster into R</h2>
<p>Now we use a raster version of the outline of Australia to extract data from the
worldclim dataset, and create one layer for mean annual temperature, and mean annual
rainfall.</p>
<p>The <code>raster()</code> command is used to read in single data objects:</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb72-1" title="1">au &lt;-<span class="st"> </span><span class="kw">raster</span>(<span class="st">&quot;data/australia.tif&quot;</span>)</a>
<a class="sourceLine" id="cb72-2" title="2"></a>
<a class="sourceLine" id="cb72-3" title="3"><span class="kw">plot</span>(au) </a></code></pre></div>
<p><img src="EE_Intro_Spatial_Workshop_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
<p>Investigate the raster: how many cells does it have? How many rows and columns? Can you calculate how large one cell is?</p>
</div>
<div id="reading-a-list-of-rasters-into-r" class="section level2">
<h2><span class="header-section-number">4.6</span> Reading a list of rasters into R</h2>
<p>As useful as single data files are, often you have to read in a lot of files at the same time, for example when working with time series such as climate data that often come in files for single months, days or years and you need to combine or summarise them for your analysis. Instead of reading in every single file individually, you can create <code>stacks</code>.</p>
<p>This is particularly useful if you intend to combine them, for example by calculating the annual mean from 12 monthly means. To do so, you can create a list from all files in a directory to read in at once, and then create a <code>stack</code> of rasters, like a thick sandwich.</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb73-1" title="1">rasterlist_t &lt;-<span class="st"> </span><span class="kw">list.files</span>(<span class="st">&quot;data/wc_tavg&quot;</span>, </a>
<a class="sourceLine" id="cb73-2" title="2">                           <span class="dt">pattern =</span> <span class="st">&quot;.tif$&quot;</span>, </a>
<a class="sourceLine" id="cb73-3" title="3">                           <span class="dt">full.names =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb73-4" title="4"></a>
<a class="sourceLine" id="cb73-5" title="5"><span class="kw">head</span>(rasterlist_t) <span class="co"># just a list</span></a></code></pre></div>
<pre><code>## [1] &quot;data/wc_tavg/wc2.0_2.5m_tavg_01.tif&quot;
## [2] &quot;data/wc_tavg/wc2.0_2.5m_tavg_02.tif&quot;
## [3] &quot;data/wc_tavg/wc2.0_2.5m_tavg_03.tif&quot;
## [4] &quot;data/wc_tavg/wc2.0_2.5m_tavg_04.tif&quot;
## [5] &quot;data/wc_tavg/wc2.0_2.5m_tavg_05.tif&quot;
## [6] &quot;data/wc_tavg/wc2.0_2.5m_tavg_06.tif&quot;</code></pre>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb75-1" title="1">t_stack &lt;-<span class="st"> </span><span class="kw">stack</span>(rasterlist_t)</a>
<a class="sourceLine" id="cb75-2" title="2"></a>
<a class="sourceLine" id="cb75-3" title="3"><span class="kw">plot</span>(t_stack) <span class="co"># you should see that there are 12 rasters</span></a></code></pre></div>
<p><img src="EE_Intro_Spatial_Workshop_files/figure-html/unnamed-chunk-28-1.png" width="672" /></p>
<p>Now do the same for the rainfall data!</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb76-1" title="1"><span class="co">#don&#39;t show code </span></a>
<a class="sourceLine" id="cb76-2" title="2">rasterlist_p &lt;-<span class="st"> </span><span class="kw">list.files</span>(<span class="st">&quot;data/wc_prec&quot;</span>, </a>
<a class="sourceLine" id="cb76-3" title="3">                           <span class="dt">pattern =</span> <span class="st">&quot;.tif$&quot;</span>, </a>
<a class="sourceLine" id="cb76-4" title="4">                           <span class="dt">full.names =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb76-5" title="5">p_stack &lt;-<span class="st"> </span><span class="kw">stack</span>(rasterlist_p)</a></code></pre></div>
</div>
<div id="challenge-one-operations-on-raster-stacks" class="section level2">
<h2><span class="header-section-number">4.7</span> Challenge One: Operations on raster stacks</h2>
<p>Now you can use any command you want ONCE on this big sandwich of rasters instead of having to use it 12 times on the single files. You can also line up several commands the you want to execute one after the other, which saves you from generating a lot of intermediary files. The <code>%&gt;%</code> (pipe command) works like that: after the first command is executed, the output gets used for the second command without assigning it to variable and storing it in memory.</p>
<p>For example, clipping a raster is a two step process. First, the raster gets cropped to the rectangular extent of the data file used for the clipping (crop function), and then all the cells that have no values in the data file <em>WITHIN</em> the square extent that is used for the clipping are set to NoData (mask function). You can check out if you can see the difference in the output if you don’t use the mask command, there are some parts around the coastline of Australia that will have data without the mask. Can you find them?</p>
<p>A single step operation would be like this:</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb77-1" title="1">t_stack_crop &lt;-<span class="st"> </span><span class="kw">crop</span>(t_stack, </a>
<a class="sourceLine" id="cb77-2" title="2">                     au) </a>
<a class="sourceLine" id="cb77-3" title="3"></a>
<a class="sourceLine" id="cb77-4" title="4">t_stack_crop_mask &lt;-<span class="st"> </span><span class="kw">mask</span>(t_stack_crop, </a>
<a class="sourceLine" id="cb77-5" title="5">                          au)</a>
<a class="sourceLine" id="cb77-6" title="6"></a>
<a class="sourceLine" id="cb77-7" title="7"><span class="kw">plot</span>(t_stack_crop_mask)</a></code></pre></div>
<p><img src="EE_Intro_Spatial_Workshop_files/figure-html/unnamed-chunk-30-1.png" width="672" /></p>
<p>You can speed things up with a pipe:</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb78-1" title="1">t_stack_au &lt;-<span class="st"> </span><span class="kw">crop</span>(t_stack, au) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb78-2" title="2"><span class="st">  </span><span class="kw">mask</span>(au)</a>
<a class="sourceLine" id="cb78-3" title="3"></a>
<a class="sourceLine" id="cb78-4" title="4">p_stack_au &lt;-<span class="st"> </span><span class="kw">crop</span>(p_stack, au) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb78-5" title="5"><span class="st">  </span><span class="kw">mask</span>(au)</a>
<a class="sourceLine" id="cb78-6" title="6"></a>
<a class="sourceLine" id="cb78-7" title="7"><span class="kw">plot</span>(p_stack_au)</a></code></pre></div>
<p><img src="EE_Intro_Spatial_Workshop_files/figure-html/unnamed-chunk-31-1.png" width="672" /></p>
<p>Now you can calculate the mean from your cropped and masked stack:</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb79-1" title="1">pmean &lt;-<span class="st"> </span><span class="kw">mean</span>(p_stack_au)</a>
<a class="sourceLine" id="cb79-2" title="2"></a>
<a class="sourceLine" id="cb79-3" title="3">tmean &lt;-<span class="st"> </span><span class="kw">mean</span>(t_stack_au)</a></code></pre></div>
<p>You can use the <code>plot()</code> command to check how your output looks or get a summary by executing the name of your new raster.</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb80-1" title="1"><span class="kw">plot</span>(tmean)</a></code></pre></div>
<p><img src="EE_Intro_Spatial_Workshop_files/figure-html/unnamed-chunk-33-1.png" width="672" /></p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb81-1" title="1"><span class="kw">plot</span>(pmean)</a></code></pre></div>
<p><img src="EE_Intro_Spatial_Workshop_files/figure-html/unnamed-chunk-33-2.png" width="672" /></p>
<p>Well done, you have mastered single rasters, raster stacks and creating new information from your data!</p>
<p>Keep in mind: the data from worldclim is of high quality, and all rasters are already in the same projection and resolution, so you can skip any exploration and preparation of the data. If your data comes from different sources, or you are not sure about the quality, always spend some time with exploration, cleaning and preparing, like omitting obvious wrong points like koalas that are not on land, or investigating NA values (what value is used for NAs (some raster data uses for example -999 or very small values), where are these NAs located, and how might this impact your analysis).</p>
</div>
<div id="writing-new-rasters-to-file" class="section level2">
<h2><span class="header-section-number">4.8</span> Writing new rasters to file</h2>
<p>You can write your new data to file if you want.</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb82-1" title="1"><span class="kw">writeRaster</span>(tmean, </a>
<a class="sourceLine" id="cb82-2" title="2">            <span class="dt">filename =</span> <span class="st">&quot;tmean.tif&quot;</span>, </a>
<a class="sourceLine" id="cb82-3" title="3">            <span class="dt">format =</span> <span class="st">&quot;GTiff&quot;</span>, </a>
<a class="sourceLine" id="cb82-4" title="4">            <span class="dt">overwrite =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
</div>
<div id="challenge-2-creating-categories-from-summarizing-and-combining-data" class="section level2">
<h2><span class="header-section-number">4.9</span> Challenge 2: Creating categories from summarizing and combining data</h2>
<p>In many cases, continuous data is what you want, but sometimes categories are more useful to get a broader overview, or with known thresholds or ranges. Some species for example only occur above a certain temperature, or in a particular elevation. Here you learn how to make categories from combining multiple continuous datasets:</p>
<p>You want to make categories for the temperature and the rainfall to get a better overview of distinct combinations. For this exercise, create four categories for temperature (cold, cool,warm, hot) and two for rainfall (dry and wet).</p>
<p>Tip: use the <code>cellStats(x, stats)</code> command to find out the quantiles as boundaries for temperature and <code>min</code>, <code>mean</code>, <code>max</code> as boundaries for the rainfall. Of course, the breakpoints that you choose will drive the quality of your results, and to derive at the values at which you want to distinguish categories might need a lot of research or knowledge. You could probably question if the words cold, cool, warm and hot fit to the quantiles. Feel free to try other breakpoints that you find more appropriate.</p>
</div>
<div id="preparation-for-the-reclassification-into-categories" class="section level2">
<h2><span class="header-section-number">4.10</span> Preparation for the reclassification into categories:</h2>
<p>Maybe you can remember how we created our first raster in the beginning - you will now create such a raster to use for reclassification. It has to show the start and endpoints for your categories (that you found out with <code>cellStats()</code> or based on more meaningful ecological knowledge), as well as the numbers you want to use as category-names:</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb83-1" title="1">tcat &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">0</span>, </a>
<a class="sourceLine" id="cb83-2" title="2">               <span class="dt">nrow =</span> <span class="dv">4</span>, </a>
<a class="sourceLine" id="cb83-3" title="3">               <span class="dt">ncol =</span> <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb83-4" title="4"></a>
<a class="sourceLine" id="cb83-5" title="5"><span class="co"># populate each row of the matrix with reclassification information for temperature</span></a>
<a class="sourceLine" id="cb83-6" title="6"></a>
<a class="sourceLine" id="cb83-7" title="7">tcat[ , <span class="dv">1</span>] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">19</span>, <span class="dv">22</span>, <span class="dv">25</span>) <span class="co"># fill in here the start of the categories </span></a>
<a class="sourceLine" id="cb83-8" title="8">tcat[ , <span class="dv">2</span>] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">19</span>, <span class="dv">22</span>, <span class="dv">25</span>, <span class="dv">30</span>) <span class="co"># fill in here the endpoint of the categories</span></a>
<a class="sourceLine" id="cb83-9" title="9">tcat[ , <span class="dv">3</span>] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>) <span class="co"># fill in here the number for the categories (1-4)</span></a>
<a class="sourceLine" id="cb83-10" title="10"></a>
<a class="sourceLine" id="cb83-11" title="11">pcat &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">0</span>, </a>
<a class="sourceLine" id="cb83-12" title="12">               <span class="dt">nrow =</span> <span class="dv">2</span>, </a>
<a class="sourceLine" id="cb83-13" title="13">               <span class="dt">ncol =</span> <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb83-14" title="14"></a>
<a class="sourceLine" id="cb83-15" title="15"><span class="co"># populate each row of the matrix with reclassification information for precipitation</span></a>
<a class="sourceLine" id="cb83-16" title="16"></a>
<a class="sourceLine" id="cb83-17" title="17">pcat[ , <span class="dv">1</span>] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">6</span>, <span class="dv">40</span>) </a>
<a class="sourceLine" id="cb83-18" title="18">pcat[ , <span class="dv">2</span>] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">40</span>, <span class="dv">380</span>)</a>
<a class="sourceLine" id="cb83-19" title="19">pcat[ , <span class="dv">3</span>] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>)</a></code></pre></div>
</div>
<div id="reclassification" class="section level2">
<h2><span class="header-section-number">4.11</span> Reclassification</h2>
<p>Now you can use the matrix for reclassification. Reclassification means that a raster will get overwritten with new values in all cells, based on bins of values. You just created these bins with your matrix. For example, all cells between 4 and 19 degrees will get assigned to category 1 in the new raster.</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb84-1" title="1">tcat_au &lt;-<span class="st"> </span><span class="kw">reclassify</span>(tmean, </a>
<a class="sourceLine" id="cb84-2" title="2">                      <span class="dt">rcl =</span> tcat, </a>
<a class="sourceLine" id="cb84-3" title="3">                      <span class="dt">right =</span> <span class="ot">FALSE</span>, </a>
<a class="sourceLine" id="cb84-4" title="4">                      <span class="dt">overwrite =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb84-5" title="5"></a>
<a class="sourceLine" id="cb84-6" title="6">pcat_au &lt;-<span class="st"> </span><span class="kw">reclassify</span>(pmean, </a>
<a class="sourceLine" id="cb84-7" title="7">                      <span class="dt">rcl =</span> pcat, </a>
<a class="sourceLine" id="cb84-8" title="8">                      <span class="dt">right =</span> <span class="ot">FALSE</span>, </a>
<a class="sourceLine" id="cb84-9" title="9">                      <span class="dt">overwrite =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb84-10" title="10"></a>
<a class="sourceLine" id="cb84-11" title="11"><span class="co"># check out what you created</span></a>
<a class="sourceLine" id="cb84-12" title="12"></a>
<a class="sourceLine" id="cb84-13" title="13"><span class="kw">plot</span>(tcat_au)</a></code></pre></div>
<p><img src="EE_Intro_Spatial_Workshop_files/figure-html/unnamed-chunk-36-1.png" width="672" /></p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb85-1" title="1"><span class="kw">plot</span>(pcat_au)</a></code></pre></div>
<p><img src="EE_Intro_Spatial_Workshop_files/figure-html/unnamed-chunk-36-2.png" width="672" /></p>
<p>Now you can combine the 2 rasters to get 8 categories for combinations of temperature and rainfall…</p>
<p>Think about it: you want to make sure that you can still see both, the values that describe the rainfall (1 &amp; 2), and the values that describe temperature (1-4). In order to be able to tell them apart, you can multiply one raster by 10 before combining them - that way you will get a combinatory value with 2 digits: one slot has a 1 or 2, and one slot a 1, 2, 3 or 4. What would happen if you just add both rasters up?</p>
<p>You can also define the colors you want for your categories. There are many websites that show colors and their names for <code>R</code>.</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb86-1" title="1">climate_au &lt;-<span class="st"> </span>tcat_au <span class="op">+</span><span class="st"> </span>pcat_au <span class="op">*</span><span class="st"> </span><span class="dv">10</span></a>
<a class="sourceLine" id="cb86-2" title="2"></a>
<a class="sourceLine" id="cb86-3" title="3"><span class="kw">plot</span>(climate_au)</a></code></pre></div>
<p><img src="EE_Intro_Spatial_Workshop_files/figure-html/unnamed-chunk-37-1.png" width="672" /></p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb87-1" title="1"><span class="co"># you can select colors for your gradients</span></a>
<a class="sourceLine" id="cb87-2" title="2"><span class="co"># define the list of colour names (see Appendix for colour names)</span></a>
<a class="sourceLine" id="cb87-3" title="3">colors &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;white&quot;</span>, </a>
<a class="sourceLine" id="cb87-4" title="4">            <span class="st">&quot;yellow&quot;</span>, </a>
<a class="sourceLine" id="cb87-5" title="5">            <span class="st">&quot;lightgreen&quot;</span>,</a>
<a class="sourceLine" id="cb87-6" title="6">            <span class="st">&quot;darkgreen&quot;</span>,</a>
<a class="sourceLine" id="cb87-7" title="7">            <span class="st">&quot;lightblue&quot;</span>,</a>
<a class="sourceLine" id="cb87-8" title="8">            <span class="st">&quot;blue&quot;</span>,</a>
<a class="sourceLine" id="cb87-9" title="9">            <span class="st">&quot;purple&quot;</span>,</a>
<a class="sourceLine" id="cb87-10" title="10">            <span class="st">&quot;red&quot;</span>)</a>
<a class="sourceLine" id="cb87-11" title="11"></a>
<a class="sourceLine" id="cb87-12" title="12">breaks &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">10</span>, <span class="dv">11</span>, <span class="dv">12</span>, <span class="dv">13</span>, <span class="dv">14</span>, <span class="dv">21</span>, <span class="dv">22</span>, <span class="dv">23</span>, <span class="dv">24</span>)</a>
<a class="sourceLine" id="cb87-13" title="13"></a>
<a class="sourceLine" id="cb87-14" title="14"><span class="co"># plot the raster</span></a>
<a class="sourceLine" id="cb87-15" title="15"></a>
<a class="sourceLine" id="cb87-16" title="16"><span class="kw">plot</span>(climate_au,</a>
<a class="sourceLine" id="cb87-17" title="17">     <span class="dt">breaks =</span> breaks, </a>
<a class="sourceLine" id="cb87-18" title="18">     <span class="dt">col =</span> colors)</a></code></pre></div>
<p><img src="EE_Intro_Spatial_Workshop_files/figure-html/unnamed-chunk-37-2.png" width="672" /></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="vector-data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="combining-vector-and-raster-data.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": null,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section",
"scroll_highlight": true,
"search": true
}
});
});
</script>

</body>

</html>
